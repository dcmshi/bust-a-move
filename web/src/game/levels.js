/**
 * levels.js
 * Level definitions for all 12 levels.
 *
 * Coordinates are 0-indexed [col, row], converted from Turing's 1-indexed (x2, y2):
 *   col = x2 - 1   (0–7)
 *   row = y2 - 1   (0–11)
 *
 * Colour IDs match the original:
 *   1=blue  2=green  3=grey   4=orange
 *   5=purple  6=yellow  7=red  8=white
 *
 * Even JS rows (row % 2 === 0) have 8 slots  (col 0–7)
 * Odd  JS rows (row % 2 === 1) have 7 slots  (col 0–6)
 */

// Sparse bubble placement: each entry is [col, row, colorId].
// Level 2 is handled separately because it has random content.
const LEVEL_BUBBLES = [

  /* ── Level 1 ─────────────────────────────────────────────────────────── */
  [
    // row 0  (Turing y2=1)
    [0,0,7],[1,0,7],[2,0,6],[3,0,6],[4,0,1],[5,0,1],[6,0,2],[7,0,2],
    // row 1  (Turing y2=2)
    [0,1,7],[1,1,7],[2,1,6],[3,1,6],[4,1,1],[5,1,1],[6,1,2],
    // row 2  (Turing y2=3)
    [0,2,1],[1,2,1],[2,2,2],[3,2,2],[4,2,7],[5,2,7],[6,2,6],[7,2,6],
    // row 3  (Turing y2=4)
    [0,3,1],[1,3,1],[2,3,2],[3,3,2],[4,3,7],[5,3,7],[6,3,6],
  ],

  /* ── Level 2 ─────────────────────────────────────────────────────────── */
  // Random column — handled in fillLevel(), not stored here.
  null,

  /* ── Level 3 ─────────────────────────────────────────────────────────── */
  [
    // row 0
    [0,0,2],[7,0,2],
    // row 1
    [0,1,7],[1,1,2],[2,1,1],[3,1,6],[4,1,7],[5,1,2],[6,1,1],
    // row 2
    [0,2,6],[2,2,6],[7,2,6],
    // row 3  — note: Turing sets (4,4)=2 then immediately overrides with (4,4)=7
    [0,3,1],[1,3,6],[2,3,7],[3,3,7],[4,3,1],[5,3,6],[6,3,7],
    // row 4
    [3,4,2],
    // row 5
    [3,5,7],
  ],

  /* ── Level 4 ─────────────────────────────────────────────────────────── */
  [
    // row 0
    [1,0,7],[2,0,3],[5,0,1],[6,0,1],
    // row 1
    [1,1,8],[5,1,5],
    // row 2
    [1,2,1],[5,2,2],
    // row 3
    [1,3,8],[5,3,2],
    // row 4
    [1,4,8],[5,4,2],
    // row 5
    [1,5,7],[5,5,8],
    // row 6
    [1,6,8],[5,6,1],
    // row 7
    [1,7,7],[5,7,2],
  ],

  /* ── Level 5 ─────────────────────────────────────────────────────────── */
  [
    // row 0
    [1,0,7],[3,0,6],[4,0,6],[6,0,5],
    // row 1
    [0,1,2],[2,1,5],[4,1,1],[6,1,7],
    // row 2
    [0,2,7],[2,2,1],[4,2,6],[6,2,5],
    // row 3
    [1,3,2],[3,3,6],[5,3,1],
    // row 4
    [1,4,7],[3,4,5],[5,4,4],
    // row 5
    [0,5,1],[2,5,2],[4,5,2],
    // row 6
    [2,6,5],[4,6,6],
    // row 7
    [3,7,7],
  ],

  /* ── Level 6 ─────────────────────────────────────────────────────────── */
  [
    // row 0
    [0,0,7],[1,0,7],[2,0,2],[3,0,7],[4,0,6],[5,0,7],[6,0,5],[7,0,2],
    // row 1
    [0,1,2],[2,1,5],[4,1,7],[6,1,7],
    // row 2
    [1,2,5],[2,2,1],[3,2,7],[4,2,1],[5,2,6],[6,2,8],
    // row 3
    [1,3,2],[3,3,6],[5,3,7],
    // row 4
    [1,4,7],[2,4,8],[3,4,6],[4,4,6],[5,4,6],[6,4,7],
    // row 5
    [0,5,8],[2,5,1],[4,5,7],[6,5,7],
    // row 6
    [0,6,2],[1,6,8],[2,6,6],[3,6,6],[4,6,2],[5,6,1],[6,6,2],[7,6,5],
  ],

  /* ── Level 7 ─────────────────────────────────────────────────────────── */
  [
    // row 0
    [3,0,7],[4,0,6],
    // row 1
    [2,1,2],[3,1,6],[4,1,2],
    // row 2
    [3,2,1],[4,2,6],
    // row 3
    [1,3,5],[2,3,6],[4,3,4],[5,3,6],
    // row 4
    [1,4,1],[2,4,4],[3,4,2],[4,4,1],[5,4,5],[6,4,5],
    // row 5
    [1,5,1],[2,5,2],[4,5,2],[5,5,1],
  ],

  /* ── Level 8 ─────────────────────────────────────────────────────────── */
  [
    // row 0
    [0,0,7],[1,0,2],[2,0,1],[3,0,6],[4,0,5],[5,0,8],[6,0,7],[7,0,2],
    // row 1
    [0,1,5],[1,1,8],[2,1,7],[3,1,2],[4,1,1],[5,1,6],[6,1,5],
    // row 2
    [0,2,7],[1,2,2],[2,2,1],[3,2,6],[4,2,5],[5,2,8],[6,2,7],[7,2,2],
    // row 3
    [0,3,5],[1,3,8],[2,3,7],[3,3,2],[4,3,1],[5,3,6],[6,3,5],
  ],

  /* ── Level 9 ─────────────────────────────────────────────────────────── */
  [
    // row 0
    [0,0,4],[1,0,4],[2,0,4],[3,0,4],[4,0,4],[5,0,4],[6,0,4],[7,0,4],
    // row 1
    [0,1,4],[6,1,4],
    // row 2  — Turing assigns (5,3)=7 twice; second is a no-op duplicate
    [0,2,4],[3,2,5],[4,2,7],[5,2,1],[6,2,5],
    // row 3
    [0,3,4],[4,3,3],[5,3,2],[6,3,3],
    // row 4
    [0,4,4],[6,4,6],[7,4,6],
    // row 5
    [0,5,1],
    // row 6
    [0,6,7],[1,6,7],[2,6,7],[3,6,7],
    // row 7
    [0,7,1],[1,7,1],[2,7,3],[3,7,2],[4,7,1],
  ],

  /* ── Level 10 ────────────────────────────────────────────────────────── */
  [
    // row 0
    [3,0,7],[4,0,2],
    // row 1
    [2,1,2],[3,1,1],[4,1,7],
    // row 2
    [2,2,1],[3,2,7],[4,2,2],[5,2,1],
    // row 3
    [1,3,7],[2,3,2],[3,3,1],[4,3,7],[5,3,2],
    // row 4
    [1,4,2],[2,4,1],[3,4,7],[4,4,2],[5,4,1],[6,4,7],
    // row 5
    [0,5,1],[1,5,7],[2,5,2],[3,5,1],[4,5,7],[5,5,2],[6,5,1],
    // row 6
    [0,6,7],[1,6,2],[2,6,1],[3,6,7],[4,6,2],[5,6,1],[6,6,7],[7,6,2],
  ],

  /* ── Level 11 ────────────────────────────────────────────────────────── */
  [
    // row 0
    [3,0,3],[4,0,1],
    // row 1
    [2,1,6],[3,1,3],[4,1,1],
    // row 2
    [2,2,8],[3,2,8],[4,2,4],[5,2,7],
    // row 3
    [1,3,6],[2,3,1],[3,3,1],[4,3,1],[5,3,8],
    // row 4
    [2,4,1],[3,4,2],[4,4,6],[5,4,8],
    // row 5
    [2,5,2],[3,5,7],[4,5,4],
    // row 6
    [3,6,4],[4,6,1],
    // row 7
    [3,7,5],
  ],

  /* ── Level 12 ────────────────────────────────────────────────────────── */
  [
    // row 0
    [0,0,1],[1,0,1],[2,0,6],[3,0,7],[4,0,7],[5,0,6],[6,0,1],[7,0,1],
    // row 1
    [0,1,3],[1,1,1],[2,1,6],[3,1,7],[4,1,6],[5,1,1],[6,1,3],
    // row 2
    [0,2,2],[1,2,4],[2,2,1],[3,2,6],[4,2,6],[5,2,1],[6,2,2],[7,2,4],
    // row 3
    [0,3,4],[1,3,3],[2,3,1],[3,3,6],[4,3,1],[5,3,5],[6,3,8],
    // row 4
    [0,4,8],[1,4,3],[2,4,4],[3,4,1],[4,4,1],[5,4,2],[6,4,2],[7,4,8],
    // row 5
    [0,5,2],[1,5,8],[2,5,6],[3,5,1],[4,5,7],[5,5,4],[6,5,4],
    // row 6
    [0,6,2],[1,6,2],[2,6,8],[3,6,7],[4,6,6],[5,6,2],[6,6,4],[7,6,4],
  ],
];

// ── Public API ────────────────────────────────────────────────────────────────

export const LEVEL_COUNT = 12;

/**
 * Returns the audio track key for a given level number (1–12).
 * Pattern: track1, track2, track3, track4, track1, track2, …
 */
export function trackForLevel(level) {
  return `track${((level - 1) % 4) + 1}`;
}

/**
 * Clears the grid and fills it with the layout for the given level.
 * Mutates the grid in place.
 *
 * @param {number}     level  1-indexed level number (1–12)
 * @param {number[][]} grid   grid[row][col], created by createGrid()
 */
export function fillLevel(level, grid) {
  // Clear
  for (let row = 0; row < grid.length; row++) {
    grid[row].fill(0);
  }

  if (level === 2) {
    // Two fixed grey bubbles at the top, then a random column below
    grid[0][3] = 3;
    grid[0][4] = 3;
    for (let row = 1; row <= 7; row++) {
      grid[row][3] = Math.floor(Math.random() * 8) + 1;
    }
    return;
  }

  const bubbles = LEVEL_BUBBLES[level - 1];
  if (!bubbles) return;

  for (const [col, row, color] of bubbles) {
    grid[row][col] = color;
  }
}
